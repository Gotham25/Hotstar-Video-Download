language: php
 
php:
  - 7.1.3

env:
 global:
  - MESSAGE="Tag Generated from TravisCI for build $TRAVIS_BUILD_NUMBER"
  - CI_BUILD_NUMBER="$TRAVIS_BUILD_NUMBER"
  - CI_PULL_REQUEST="$TRAVIS_PULL_REQUEST"
  - CI_BRANCH="$TRAVIS_BRANCH"
  
install:
 - curl -s http://getcomposer.org/installer | php
 - php composer.phar install --dev --no-interaction
 - composer require php-coveralls/php-coveralls

script:
 - rm -rf build/
 - mkdir -p build/logs
 - echo "Binaries downloaded successfully"
 - echo "Starting php lint check for php files"
 - php -l downloadVideo.php >> build/logs/lint_check.log
 - php -l generateVideo.php >> build/logs/lint_check.log
 - php -l getAvailableVideoFormats.php >> build/logs/lint_check.log
 - php -l UploadToGoogleDrive.php >> build/logs/lint_check.log
 - php -l src/VideoFormats.php >> build/logs/lint_check.log
 - php -l src/helper/hotstarauthgenerator.php >> build/logs/lint_check.log
 - php -l src/helper/m3u8Parser.php >> build/logs/lint_check.log
 - php -l src/helper/utils.php >> build/logs/lint_check.log
 - php -l tests/bootstrap.php >> build/logs/lint_check.log
 - php -l tests/utilsTest.php >> build/logs/lint_check.log
 - php -l tests/VideoFormatsTest.php >> build/logs/lint_check.log
 - php -l tests/m3u8ParserTest.php >> build/logs/lint_check.log
 - php -l gdriveUpload.php >> build/logs/lint_check.log
 - php -l getConfigVars.php >> build/logs/lint_check.log
 - php -l oauthFetchGoogleDrive.php >> build/logs/lint_check.log
 - php -l redirect_google.php >> build/logs/lint_check.log
 - echo "PHP lint check completed successfully"
 - phpunit --configuration phpunit.xml

after_success:
 - travis_retry php vendor/bin/php-coveralls -v
 - echo $MESSAGE >> build/build.log

deploy:
 provider: releases
 api_key: $GITHUB_TOKEN
 file_glob: true
 file: build/**/*
 skip_cleanup: true
 on:
    tags: true